# ç½‘ç»œè¾“å…¥è¾“å‡ºè¯¦è§£

## ä¸€ã€ç½‘ç»œæ¶æ„æ¦‚è¿°

å½“å‰ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ **UNet** æ¨¡å‹ï¼ˆ`projects/ocnn/models/unet.py`ï¼‰ï¼Œæ”¯æŒä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š
1. **å®Œæ•´ç¼–ç å™¨-è§£ç å™¨æ¨¡å¼** (`use_decoder=True`)
2. **ä»…ç¼–ç å™¨æ¨¡å¼** (`use_decoder=False`)

---

## äºŒã€ç½‘ç»œè¾“å…¥ï¼ˆForward Inputï¼‰

### 2.1 å®Œæ•´è¾“å…¥ç­¾å

```python
def forward(self, data, octree, depth, query_pts, tool_params):
    """
    UNet forward pass
    
    Args:
        data: torch.Tensor         # å…«å‰æ ‘èŠ‚ç‚¹ç‰¹å¾
        octree: Octree             # å…«å‰æ ‘æ•°æ®ç»“æ„
        depth: int                 # å…«å‰æ ‘æ·±åº¦
        query_pts: torch.Tensor    # æŸ¥è¯¢ç‚¹åæ ‡ + batch_id
        tool_params: torch.Tensor  # åˆ€å…·å‚æ•°
    
    Returns:
        angles: torch.Tensor       # é¢„æµ‹çš„å§¿æ€è§’åº¦ [B, 2]
    """
```

### 2.2 è¾“å…¥å‚æ•°è¯¦è§£

#### ğŸ“Œ **å‚æ•°1: `data` - å…«å‰æ ‘èŠ‚ç‚¹ç‰¹å¾**
- **ç±»å‹**: `torch.Tensor`
- **å½¢çŠ¶**: `[N_nodes, C_in]`
  - `N_nodes`: å…«å‰æ ‘ä¸­æ‰€æœ‰éç©ºèŠ‚ç‚¹çš„æ€»æ•°ï¼ˆæ‰€æœ‰batchåˆå¹¶ï¼‰
  - `C_in`: è¾“å…¥ç‰¹å¾ç»´åº¦ï¼ˆé€šå¸¸ä¸º4ï¼‰
- **å†…å®¹**: ä»å…«å‰æ ‘ä¸­æå–çš„ç‰¹å¾ï¼Œç”± `InputFeature` æ¨¡å—ç”Ÿæˆ
- **ç‰¹å¾ç±»å‹**ï¼ˆç”±é…ç½® `MODEL.feature` å†³å®šï¼‰:
  - `'ND'`: Normal + Depthï¼ˆæ³•çº¿ + æ·±åº¦ä¿¡æ¯ï¼‰
  - `'N'`: ä»…æ³•çº¿
  - `'D'`: ä»…æ·±åº¦
  - `'L'`: Labelä¿¡æ¯
- **ç”Ÿæˆè¿‡ç¨‹**:
```python
# åœ¨ segmentation.py ä¸­ï¼š
def get_input_feature(self, octree):
    flags = self.FLAGS.MODEL
    octree_feature = ocnn.modules.InputFeature(flags.feature, flags.nempty)
    data = octree_feature(octree)  # [N_nodes, 4]
    return data
```

---

#### ğŸ“Œ **å‚æ•°2: `octree` - å…«å‰æ ‘æ•°æ®ç»“æ„**
- **ç±»å‹**: `ocnn.octree.Octree` å¯¹è±¡
- **ä½œç”¨**: å­˜å‚¨3Dç‚¹äº‘çš„ç¨€ç–è¡¨ç¤º
- **å…³é”®å±æ€§**:
  - `octree.depth`: æœ€å¤§æ·±åº¦ï¼ˆé€šå¸¸ä¸º5ï¼Œå³ 2^5=32 åˆ†è¾¨ç‡ï¼‰
  - `octree.batch_size`: æ‰¹é‡å¤§å°
  - `octree.batch_nnum`: æ¯å±‚æ¯ä¸ªbatchçš„èŠ‚ç‚¹æ•°
  - `octree.keys`: èŠ‚ç‚¹çš„ç©ºé—´ç¼–ç 
- **æ„å»ºè¿‡ç¨‹**:
```python
def process_batch(self, batch, flags):
    def points2octree(points):
        octree = ocnn.octree.Octree(flags.depth, flags.full_depth)
        octree.build_octree(points)  # ä»ç‚¹äº‘æ„å»º
        return octree
    
    points = [pts.cuda() for pts in batch['points']]
    octrees = [points2octree(pts) for pts in points]
    octree = ocnn.octree.merge_octrees(octrees)  # åˆå¹¶batch
    octree.construct_all_neigh()  # æ„å»ºé‚»åŸŸå…³ç³»
    return octree
```

**é…ç½®å‚æ•°**ï¼ˆ`seg_deepmill.yaml`ï¼‰:
```yaml
DATA:
  train:
    depth: 5          # æœ€å¤§æ·±åº¦ï¼š2^5 = 32 Ã— 32 Ã— 32
    full_depth: 2     # å‰2å±‚å…¨å¡«å……ï¼š2^2 = 4 Ã— 4 Ã— 4
```

---

#### ğŸ“Œ **å‚æ•°3: `depth` - å…«å‰æ ‘æ·±åº¦**
- **ç±»å‹**: `int`
- **å€¼**: 5ï¼ˆé»˜è®¤ï¼‰
- **å«ä¹‰**: å…«å‰æ ‘çš„æœ€å¤§å±‚æ•°ï¼Œå†³å®šç©ºé—´åˆ†è¾¨ç‡
- **åˆ†è¾¨ç‡æ˜ å°„**:
  - depth=5 â†’ 32Â³ = 32,768 ä½“ç´ 
  - depth=6 â†’ 64Â³ = 262,144 ä½“ç´ 
  - depth=7 â†’ 128Â³ = 2,097,152 ä½“ç´ 

---

#### ğŸ“Œ **å‚æ•°4: `query_pts` - æŸ¥è¯¢ç‚¹åæ ‡**
- **ç±»å‹**: `torch.Tensor`
- **å½¢çŠ¶**: `[N_total_points, 4]`
  - `N_total_points`: æ‰€æœ‰batchçš„ç‚¹äº‘æ€»ç‚¹æ•°
  - ç¬¬4ç»´: `[x, y, z, batch_id]`
- **ä½œç”¨**: åœ¨å…«å‰æ ‘ç‰¹å¾ä¸Šè¿›è¡Œæ’å€¼æŸ¥è¯¢
- **ç”Ÿæˆè¿‡ç¨‹**:
```python
def model_forward(self, batch):
    octree, points = batch['octree'], batch['points']
    query_pts = torch.cat([points.points, points.batch_id], dim=1)
    # points.points: [N, 3] - ç‚¹äº‘åæ ‡
    # points.batch_id: [N, 1] - æ¯ä¸ªç‚¹å±äºå“ªä¸ªbatch
```

**ç¤ºä¾‹**:
```python
# å‡è®¾ batch_size=2, æ¯ä¸ªæ ·æœ¬1024ä¸ªç‚¹
query_pts.shape  # [2048, 4]
query_pts[0]     # [0.123, -0.456, 0.789, 0]  (batch_id=0)
query_pts[1024]  # [0.234, 0.567, -0.890, 1]  (batch_id=1)
```

---

#### ğŸ“Œ **å‚æ•°5: `tool_params` - åˆ€å…·å‚æ•°**
- **ç±»å‹**: `torch.Tensor`
- **å½¢çŠ¶**: `[B, 4]`
  - `B`: batch_size
  - 4ç»´åˆ€å…·å‚æ•°
- **å†…å®¹**: åˆ€å…·çš„å‡ ä½•å‚æ•°ï¼ˆå…·ä½“å«ä¹‰å–å†³äºæ•°æ®é›†ï¼‰
  - å¯èƒ½åŒ…æ‹¬ï¼šç›´å¾„ã€é•¿åº¦ã€é½¿æ•°ã€èºæ—‹è§’ç­‰
- **æ•°æ®æ¥æº**: ä»æ–‡ä»¶åˆ—è¡¨ä¸­è¯»å–

**è¯»å–è¿‡ç¨‹**ï¼ˆ`thsolver/dataset.py`ï¼‰:
```python
def load_filenames(self):
    filenames, labels, tool_params = [], [], []
    with open(self.filelist) as fid:
        lines = fid.readlines()
    for line in lines:
        tokens = line.split()
        filename = tokens[0]
        label = tokens[1]
        tool_param = tokens[-4:]  # å–æœ€å4ä¸ªå­—æ®µä½œä¸ºåˆ€å…·å‚æ•°
        
        filenames.append(filename)
        labels.append(int(label))
        tool_params.append(tool_param)
```

**æ–‡ä»¶åˆ—è¡¨æ ¼å¼ç¤ºä¾‹**:
```
models/00181080_1b7d16dab26af7058f098574_trimesh_000_collision_detection.ply 0 3.0 5.0 2.0 1.5
# æ–‡ä»¶è·¯å¾„  ç±»åˆ«ID  tool_param1  tool_param2  tool_param3  tool_param4
```

**è½¬æ¢ä¸ºtensor**:
```python
tool_params = self._to_cuda_float_tensor(batch['tool_params'])
# è¾“å‡º: [B, 4] float32 tensor on cuda
```

---

## ä¸‰ã€ç½‘ç»œè¾“å‡ºï¼ˆForward Outputï¼‰

### 3.1 è¾“å‡ºç­¾å

```python
def forward(self, data, octree, depth, query_pts, tool_params):
    """
    Returns:
        angles: torch.Tensor of shape [B, 2] in degrees
                order = [pitch, roll]
                with pitch âˆˆ [-90, 90], roll âˆˆ [-180, 180]
    """
```

### 3.2 è¾“å‡ºè¯¦è§£

#### ğŸ“Œ **è¾“å‡º: `angles` - å§¿æ€è§’åº¦**
- **ç±»å‹**: `torch.Tensor`
- **å½¢çŠ¶**: `[B, 2]`
  - `B`: batch_size
  - 2ç»´: `[pitch, roll]`
- **å•ä½**: åº¦ï¼ˆdegreesï¼‰
- **å–å€¼èŒƒå›´**:
  - `pitch`: [-90Â°, 90Â°] ï¼ˆä¿¯ä»°è§’ï¼‰
  - `roll`: [-180Â°, 180Â°] ï¼ˆç¿»æ»šè§’ï¼‰

**è®¡ç®—è¿‡ç¨‹**:
```python
# 1. MLPè¾“å‡ºåŸå§‹logits
raw = self.pose_head(fused)  # [B, 2]

# 2. å¦‚æœuse_tanh_head=Trueï¼Œrawå·²åœ¨(-1, 1)èŒƒå›´
if not self.use_tanh_head:
    raw = torch.tanh(raw)  # é™åˆ¶åˆ°(-1, 1)

# 3. æ˜ å°„åˆ°è§’åº¦èŒƒå›´
pitch = 90.0 * raw[:, 0]   # (-1,1) -> (-90, 90)
roll = 180.0 * raw[:, 1]   # (-1,1) -> (-180, 180)

# 4. å †å è¾“å‡º
angles = torch.stack([pitch, roll], dim=1)  # [B, 2]
return angles
```

**è¾“å‡ºç¤ºä¾‹**:
```python
# å‡è®¾ batch_size=4
angles = torch.tensor([
    [-45.2,  120.5],  # sample 0: pitch=-45.2Â°, roll=120.5Â°
    [ 23.8,  -90.3],  # sample 1: pitch=23.8Â°,  roll=-90.3Â°
    [  0.5,  179.9],  # sample 2: pitch=0.5Â°,   roll=179.9Â°
    [-89.1, -175.6]   # sample 3: pitch=-89.1Â°, roll=-175.6Â°
])
```

---

## å››ã€å®Œæ•´æ•°æ®æµï¼ˆEnd-to-End Pipelineï¼‰

### 4.1 è®­ç»ƒé˜¶æ®µæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ•°æ®åŠ è½½ (Dataset.__getitem__)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    è¯»å– .ply ç‚¹äº‘æ–‡ä»¶ â†’ Points å¯¹è±¡
    è¯»å–æ‰“åˆ†è¡¨ (338ç»´) â†’ labels [338]
    è¯»å–åˆ€å…·å‚æ•° (4ç»´)  â†’ tool_params [4]
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ‰¹é‡æ‹¼æ¥ (CollateBatch)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    batch = {
        'points': [Points_0, Points_1, ..., Points_{B-1}],
        'labels': [label_0, label_1, ..., label_{B-1}],     # (B, 338)
        'tool_params': [tp_0, tp_1, ..., tp_{B-1}]          # (B, 4)
    }
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å…«å‰æ ‘æ„å»º (process_batch)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    [Points_i] â†’ Octree_i â†’ merge â†’ Octree (merged)
                        â†“
    batch['octree'] = Octree                    # åˆå¹¶çš„å…«å‰æ ‘
    batch['points'] = merged_Points             # åˆå¹¶çš„ç‚¹äº‘
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç‰¹å¾æå– (get_input_feature)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    Octree â†’ InputFeature('ND') â†’ data [N_nodes, 4]
    Points â†’ query_pts [N_total_points, 4]
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ¨¡å‹å‰å‘ä¼ æ’­ (UNet.forward)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    è¾“å…¥:
        data:        [N_nodes, 4]
        octree:      Octreeå¯¹è±¡
        depth:       5
        query_pts:   [N_total_points, 4]
        tool_params: [B, 4]
                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Encoder (ä¸‹é‡‡æ · + ResBlocks)        â”‚
    â”‚    depth 5 â†’ 4 â†’ 3 â†’ 2 â†’ 1          â”‚
    â”‚  Features: [N_i, C_i] at each depth â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  åˆ€å…·å‚æ•°åµŒå…¥                         â”‚
    â”‚    tool_params [B,4] â†’ FC â†’ [B,128] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  å¦‚æœuse_decoder=True:               â”‚
    â”‚    Decoder (ä¸Šé‡‡æ · + åˆ€å…·èåˆ)        â”‚
    â”‚  å¦‚æœuse_decoder=False:              â”‚
    â”‚    Pyramid Pooling + åˆ€å…·èåˆ         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Octree Interpolation                â”‚
    â”‚    Features â†’ Pointsç‰¹å¾              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Global Pooling (per batch)          â”‚
    â”‚    [N_pts, C] â†’ [B, C]               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MLP Head (å«æˆ–ä¸å«Tanh)              â”‚
    â”‚    [B, C+128] â†’ [B, 128] â†’ [B, 2]    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    è¾“å‡º:
        angles: [B, 2]  # [pitch, roll] in degrees
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æŸå¤±è®¡ç®— (loss_function_pro)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
    angles [B, 2] â†’ Rotation Matrix [B, 3, 3]
    è®¡ç®—ä¸338ä¸ªé¢„å®šä¹‰çŸ©é˜µçš„æµ‹åœ°è·ç¦»
    è½¯åˆ†é… + æ‰“åˆ†è¡¨åŠ æƒ â†’ loss (scalar)
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. åå‘ä¼ æ’­ & ä¼˜åŒ–                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.2 æ¨ç†é˜¶æ®µæ•°æ®æµ

```
è¾“å…¥: ç‚¹äº‘æ–‡ä»¶ (.ply) + åˆ€å…·å‚æ•° (4ç»´)
         â†“
    æ„å»ºOctree
         â†“
    UNet.forward(data, octree, depth, query_pts, tool_params)
         â†“
    è¾“å‡º: angles [B, 2]  # [pitch, roll] in degrees
         â†“
    è½¬æ¢ä¸ºæ—‹è½¬çŸ©é˜µ: R [B, 3, 3]
         â†“
    ä¿å­˜: .eval.npz
        - angles_deg: [2]
        - R: [3, 3]
```

---

## äº”ã€ä¸åŒæ¨¡å¼ä¸‹çš„ç½‘ç»œç»“æ„å¯¹æ¯”

### 5.1 æ¨¡å¼1: å®Œæ•´ç¼–ç å™¨-è§£ç å™¨ (`use_decoder=True`)

**é…ç½®**:
```yaml
MODEL:
  use_decoder: true
```

**ç½‘ç»œç»“æ„**:
```
è¾“å…¥: data [N_nodes, 4]
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Encoder                              â”‚
    â”‚  conv1: [N_d5, 4] â†’ [N_d5, 32]      â”‚
    â”‚  down:  [N_d5, 32] â†’ [N_d4, 64]     â”‚
    â”‚  res:   [N_d4, 64] â†’ [N_d4, 64]     â”‚
    â”‚  down:  [N_d4, 64] â†’ [N_d3, 128]    â”‚
    â”‚  res:   [N_d3, 128] â†’ [N_d3, 128]   â”‚
    â”‚  down:  [N_d3, 128] â†’ [N_d2, 256]   â”‚
    â”‚  res:   [N_d2, 256] â†’ [N_d2, 256]   â”‚
    â”‚  down:  [N_d2, 256] â†’ [N_d1, 512]   â”‚
    â”‚  res:   [N_d1, 512] â†’ [N_d1, 512]   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ åˆ€å…·å‚æ•°åˆ†æ”¯ (4ä¸ªç‹¬ç«‹FC)              â”‚
    â”‚  tool_params [B,4]                   â”‚
    â”‚    â†’ fc1 â†’ [B,256]  (decoder stage1) â”‚
    â”‚    â†’ fc2 â†’ [B,256]  (decoder stage2) â”‚
    â”‚    â†’ fc3 â†’ [B,256]  (decoder stage3) â”‚
    â”‚    â†’ fc4 â†’ [B,256]  (decoder stage4) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Decoder (with skip + tool fusion)    â”‚
    â”‚  up: [N_d1, 512] â†’ [N_d2, 256]      â”‚
    â”‚  cat: [skip_d2 + tool1] â†’ [N_d2, X] â”‚
    â”‚  res: [N_d2, X] â†’ [N_d2, 256]       â”‚
    â”‚                                      â”‚
    â”‚  up: [N_d2, 256] â†’ [N_d3, 128]      â”‚
    â”‚  cat: [skip_d3 + tool2] â†’ [N_d3, X] â”‚
    â”‚  res: [N_d3, X] â†’ [N_d3, 128]       â”‚
    â”‚                                      â”‚
    â”‚  up: [N_d3, 128] â†’ [N_d4, 64]       â”‚
    â”‚  cat: [skip_d4 + tool3] â†’ [N_d4, X] â”‚
    â”‚  res: [N_d4, X] â†’ [N_d4, 64]        â”‚
    â”‚                                      â”‚
    â”‚  up: [N_d4, 64] â†’ [N_d5, 32]        â”‚
    â”‚  cat: [skip_d5 + tool4] â†’ [N_d5, X] â”‚
    â”‚  res: [N_d5, X] â†’ [N_d5, 96]        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Octree Interpolation                 â”‚
    â”‚  [N_d5, 96] â†’ [N_pts, 96]           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Global Mean Pooling                  â”‚
    â”‚  [N_pts, 96] â†’ [B, 96]              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MLP Head                             â”‚
    â”‚  [B, 96] â†’ [B, 128] â†’ [B, 2]        â”‚
    â”‚  (å¯é€‰Tanhæ¿€æ´»)                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
è¾“å‡º: angles [B, 2]  # [pitch, roll]
```

---

### 5.2 æ¨¡å¼2: ä»…ç¼–ç å™¨ (`use_decoder=False`)

**é…ç½®**:
```yaml
MODEL:
  use_decoder: false
  pyramid_levels: (0)        # åªä½¿ç”¨æœ€æ·±ç¼–ç å±‚
  tool_fusion: 'concat'      # æˆ– 'film' / 'no_tool'
  use_attention_pool: false  # ä½¿ç”¨mean pooling
```

**ç½‘ç»œç»“æ„**:
```
è¾“å…¥: data [N_nodes, 4]
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Encoder (åŒä¸Š)                       â”‚
    â”‚  depth 5 â†’ 4 â†’ 3 â†’ 2 â†’ 1            â”‚
    â”‚  Features at each depth              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ åˆ€å…·å‚æ•°åµŒå…¥                         â”‚
    â”‚  tool_params [B,4]                   â”‚
    â”‚    â†’ Linear(4, 64) â†’ ReLU â†’ BN      â”‚
    â”‚    â†’ Linear(64, 128) â†’ ReLU         â”‚
    â”‚    â†’ tool_embed [B, 128]            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Pyramid Pooling                      â”‚
    â”‚  é€‰æ‹©pyramid_levelsä¸­æŒ‡å®šçš„æ·±åº¦       â”‚
    â”‚  ä¾‹å¦‚: depths = [1] (æœ€æ·±å±‚)         â”‚
    â”‚                                      â”‚
    â”‚  For each depth d:                   â”‚
    â”‚    1. Octree Interp:                 â”‚
    â”‚       [N_d, C_d] â†’ [N_pts, C_d]     â”‚
    â”‚    2. Pooling (Meanæˆ–Attention):     â”‚
    â”‚       [N_pts, C_d] â†’ [B, C_d]       â”‚
    â”‚                                      â”‚
    â”‚  Concat all: [B, Î£C_d]              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ åˆ€å…·èåˆ                             â”‚
    â”‚  if tool_fusion == 'concat':         â”‚
    â”‚    [B, Î£C_d] + [B, 128] â†’ [B, X]    â”‚
    â”‚  elif tool_fusion == 'film':         â”‚
    â”‚    gamma, beta = FC(tool_embed)      â”‚
    â”‚    fused = gamma * feat + beta       â”‚
    â”‚  elif tool_fusion == 'no_tool':      â”‚
    â”‚    fused = feat (ä¸ä½¿ç”¨tool_embed)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MLP Head                             â”‚
    â”‚  [B, X] â†’ [B, 128] â†’ [B, 2]         â”‚
    â”‚  (å¯é€‰Tanhæ¿€æ´»)                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
è¾“å‡º: angles [B, 2]  # [pitch, roll]
```

---

## å…­ã€å…³é”®é…ç½®å‚æ•°å¯¹è¾“å…¥è¾“å‡ºçš„å½±å“

### 6.1 å½±å“è¾“å…¥çš„é…ç½®

| é…ç½®é¡¹ | ä½ç½® | é»˜è®¤å€¼ | å½±å“ |
|--------|------|--------|------|
| `DATA.train.depth` | YAML | 5 | å…«å‰æ ‘æ·±åº¦ï¼Œå½±å“ `N_nodes` æ•°é‡ |
| `DATA.train.full_depth` | YAML | 2 | å‰nå±‚å…¨å¡«å…… |
| `DATA.train.batch_size` | YAML | 8 | æ‰¹é‡å¤§å° `B` |
| `MODEL.feature` | YAML | 'ND' | è¾“å…¥ç‰¹å¾ç±»å‹ï¼Œå½±å“ `C_in` |
| `MODEL.channel` | YAML | 4 | ç¬¬ä¸€å±‚å·ç§¯è¾“å‡ºé€šé“æ•° |

### 6.2 å½±å“è¾“å‡ºçš„é…ç½®

| é…ç½®é¡¹ | ä½ç½® | é»˜è®¤å€¼ | å½±å“ |
|--------|------|--------|------|
| `MODEL.nout` | YAML | 6 | è¾“å‡ºç»´åº¦ï¼ˆå½“å‰å¼ºåˆ¶ä¸º2ï¼‰ |
| `MODEL.use_tanh_head` | YAML | true | æ˜¯å¦ä½¿ç”¨Tanhé™åˆ¶è¾“å‡ºèŒƒå›´ |

**æ³¨æ„**: è™½ç„¶ `MODEL.nout=6`ï¼Œä½†å®é™…ä»£ç ä¸­ç¡¬ç¼–ç è¾“å‡ºä¸º2ç»´è§’åº¦ã€‚

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¾“å…¥æ˜¯ç¨€ç–çš„ `[N_nodes, C]` è€Œä¸æ˜¯å¯†é›†çš„ `[B, C, H, W, D]`ï¼Ÿ

**A**: å› ä¸ºä½¿ç”¨äº†å…«å‰æ ‘ï¼ˆOctreeï¼‰ç¨€ç–è¡¨ç¤ºï¼š
- **ä¼˜åŠ¿**: èŠ‚çœå†…å­˜ï¼ˆåªå­˜å‚¨éç©ºä½“ç´ ï¼‰ï¼ŒåŠ é€Ÿè®¡ç®—
- **ä»£ä»·**: éœ€è¦ä¸“é—¨çš„å·ç§¯ç®—å­ï¼ˆ`octree_conv`ï¼‰

å¯¹æ¯”:
- å¯†é›†3Då·ç§¯: 32Â³ = 32,768 ä¸ªä½“ç´ ï¼ˆå¤§éƒ¨åˆ†ä¸ºç©ºï¼‰
- å…«å‰æ ‘: é€šå¸¸åªæœ‰ 1,000-5,000 ä¸ªéç©ºèŠ‚ç‚¹

### Q2: `query_pts` çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

**A**: å°†å…«å‰æ ‘ç‰¹å¾æ’å€¼å›åŸå§‹ç‚¹äº‘ï¼š
1. å·ç§¯åœ¨å…«å‰æ ‘èŠ‚ç‚¹ä¸Šæ“ä½œï¼ˆç¨€ç–ï¼‰
2. æœ€åéœ€è¦æ’å€¼åˆ°åŸå§‹ç‚¹äº‘åæ ‡ï¼ˆç¨ å¯†ï¼‰
3. `query_pts` æŒ‡å®šæ’å€¼çš„ç›®æ ‡ä½ç½®

### Q3: ä¸ºä»€ä¹ˆè¾“å‡ºæ˜¯è§’åº¦è€Œä¸æ˜¯æ—‹è½¬çŸ©é˜µï¼Ÿ

**A**: ç½‘ç»œç›´æ¥é¢„æµ‹è§’åº¦ï¼ˆ2ç»´ï¼‰ï¼Œåœ¨lossè®¡ç®—æ—¶å†è½¬æ¢ä¸ºæ—‹è½¬çŸ©é˜µï¼š
- **ç½‘ç»œè¾“å‡º**: `[pitch, roll]` æ˜“äºä¼˜åŒ–
- **Lossè®¡ç®—**: è½¬ä¸ºæ—‹è½¬çŸ©é˜µåæ¯”è¾ƒï¼ˆæµ‹åœ°è·ç¦»ï¼‰
- **æ¨ç†è¾“å‡º**: åŒæ—¶ä¿å­˜è§’åº¦å’Œæ—‹è½¬çŸ©é˜µ

### Q4: åˆ€å…·å‚æ•°ä¸ºä»€ä¹ˆæ˜¯4ç»´ï¼Ÿ

**A**: å–å†³äºæ•°æ®é›†è®¾è®¡ï¼Œå¯èƒ½åŒ…æ‹¬ï¼š
- åˆ€å…·ç›´å¾„ (diameter)
- åˆ€å…·é•¿åº¦ (length)
- é½¿æ•° (teeth number)
- èºæ—‹è§’ (helix angle)

å…·ä½“å«ä¹‰éœ€æŸ¥çœ‹æ•°æ®å‡†å¤‡è„šæœ¬ã€‚

### Q5: å¦‚ä½•ä¿®æ”¹è¾“å‡ºç»´åº¦ï¼Ÿ

**A**: å½“å‰æ¶æ„å›ºå®šè¾“å‡º2ç»´è§’åº¦ï¼ˆpitch, rollï¼‰ã€‚å¦‚éœ€å¢åŠ ç¬¬ä¸‰ä¸ªè§’åº¦ï¼ˆå¦‚yawï¼‰ï¼Œéœ€ä¿®æ”¹ï¼š

```python
# unet.py line 148
nn.Linear(128, 3),  # æ”¹ä¸º3ç»´è¾“å‡º

# unet.py line 380-382
pitch = 90.0 * raw[:, 0]
roll = 180.0 * raw[:, 1]
yaw = 180.0 * raw[:, 2]  # æ–°å¢
angles = torch.stack([pitch, roll, yaw], dim=1)

# segmentation.py ä¸­ç›¸åº”ä¿®æ”¹ _angles_to_rotation_matrix
```

---

## å…«ã€è°ƒè¯•æŠ€å·§

### 8.1 æ‰“å°ä¸­é—´å½¢çŠ¶

```python
# åœ¨ unet.py forward ä¸­æ·»åŠ 
def forward(self, data, octree, depth, query_pts, tool_params):
    print(f"Input data shape: {data.shape}")
    print(f"Query pts shape: {query_pts.shape}")
    print(f"Tool params shape: {tool_params.shape}")
    print(f"Batch size: {tool_params.size(0)}")
    
    convd = self.unet_encoder(data, octree, depth)
    print(f"Encoder output shapes: {[(k, v.shape) for k, v in convd.items()]}")
    
    # ... åç»­å¤„ç† ...
    
    print(f"Final angles shape: {angles.shape}")
    print(f"Angles range: pitch [{angles[:, 0].min():.2f}, {angles[:, 0].max():.2f}], "
          f"roll [{angles[:, 1].min():.2f}, {angles[:, 1].max():.2f}]")
    
    return angles
```

### 8.2 å¯è§†åŒ–è¾“å‡ºåˆ†å¸ƒ

```python
import matplotlib.pyplot as plt

# è®­ç»ƒåæŸ¥çœ‹è§’åº¦é¢„æµ‹åˆ†å¸ƒ
angles = model(data, octree, depth, query_pts, tool_params)
pitch, roll = angles[:, 0].cpu(), angles[:, 1].cpu()

plt.figure(figsize=(12, 4))
plt.subplot(1, 2, 1)
plt.hist(pitch, bins=50)
plt.title('Pitch Distribution')
plt.xlabel('Degrees')

plt.subplot(1, 2, 2)
plt.hist(roll, bins=50)
plt.title('Roll Distribution')
plt.xlabel('Degrees')
plt.savefig('angle_distribution.png')
```

---

## ä¹ã€æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **è¾“å…¥**: å…«å‰æ ‘ç¨€ç–è¡¨ç¤º + åˆ€å…·å‚æ•°ï¼ˆ4ç»´ï¼‰
2. **è¾“å‡º**: å§¿æ€è§’åº¦ï¼ˆ2ç»´ï¼‰[pitch, roll] in degrees
3. **ç‰¹ç‚¹**: 
   - é«˜æ•ˆçš„ç¨€ç–3Då·ç§¯
   - åˆ€å…·å‚æ•°æ„ŸçŸ¥ï¼ˆå¤šç§èåˆç­–ç•¥ï¼‰
   - å¯é…ç½®çš„ç¼–ç å™¨/è§£ç å™¨ç»“æ„
4. **æ•°æ®æµ**: ç‚¹äº‘ â†’ å…«å‰æ ‘ â†’ ç‰¹å¾æå– â†’ å·ç§¯ â†’ æ± åŒ– â†’ MLP â†’ è§’åº¦

### è¾“å…¥è¾“å‡ºè§„æ ¼ä¸€è§ˆè¡¨

| é¡¹ç›® | å½¢çŠ¶ | æ•°æ®ç±»å‹ | è®¾å¤‡ | å–å€¼èŒƒå›´ |
|------|------|----------|------|----------|
| **è¾“å…¥** |
| `data` | `[N_nodes, 4]` | `float32` | CUDA | å½’ä¸€åŒ–ç‰¹å¾ |
| `octree` | `Octreeå¯¹è±¡` | - | CUDA | - |
| `depth` | `æ ‡é‡` | `int` | CPU | é€šå¸¸ä¸º5 |
| `query_pts` | `[N_pts, 4]` | `float32` | CUDA | xyz + batch_id |
| `tool_params` | `[B, 4]` | `float32` | CUDA | åˆ€å…·å‚æ•° |
| **è¾“å‡º** |
| `angles` | `[B, 2]` | `float32` | CUDA | pitch: [-90,90], roll: [-180,180] |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-11-06  
**å¯¹åº”æ¨¡å‹**: `projects/ocnn/models/unet.py`  
**ç»´æŠ¤è€…**: xinguanze

